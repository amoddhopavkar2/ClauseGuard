"use strict";(()=>{var c={enabled:!0,onlyLegalPages:!0,sensitivity:"normal",highlightColors:{arbitration:"#ff6b6b","auto-renew":"#ffa94d","data-sharing":"#ff8787","data-retention":"#ffd43b","unilateral-changes":"#69db7c",liability:"#74c0fc","governing-law":"#b197fc"},allowlist:[],denylist:[],domainOverrides:{},skipElements:["script","style","noscript","textarea","input","code","pre","svg"]};var y={arbitration:{label:"Arbitration / Waiver",icon:"\u2696\uFE0F"},"auto-renew":{label:"Auto-Renewal / Billing",icon:"\u{1F4B3}"},"data-sharing":{label:"Data Sharing",icon:"\u{1F4E4}"},"data-retention":{label:"Data Retention",icon:"\u{1F4BE}"},"unilateral-changes":{label:"Unilateral Changes",icon:"\u{1F4DD}"},liability:{label:"Liability Limits",icon:"\u{1F6E1}\uFE0F"},"governing-law":{label:"Governing Law",icon:"\u{1F3DB}\uFE0F"}};var e=t=>new RegExp(t,"gi"),N=[{id:"arb-binding",category:"arbitration",pattern:e("binding\\s+arbitration"),severity:"critical",weight:10,description:"Requires disputes to be resolved through binding arbitration",critical:!0},{id:"arb-class-action",category:"arbitration",pattern:e("class\\s+action\\s+waiver"),severity:"critical",weight:10,description:"Waives your right to participate in class action lawsuits",critical:!0},{id:"arb-waive-right",category:"arbitration",pattern:e("waive\\s+(your|the)\\s+right\\s+to"),severity:"high",weight:8,description:"Requires you to waive certain legal rights"},{id:"arb-jury-waive",category:"arbitration",pattern:e("jury\\s+trial[^.]*waive|waive[^.]*jury\\s+trial"),severity:"critical",weight:9,description:"Waives your right to a jury trial",critical:!0},{id:"arb-no-class",category:"arbitration",pattern:e("(may\\s+not|cannot|shall\\s+not)\\s+(bring|file|pursue)[^.]*class\\s+action"),severity:"high",weight:8,description:"Prohibits bringing class action lawsuits"},{id:"arb-aaa",category:"arbitration",pattern:e("(AAA|American\\s+Arbitration\\s+Association)"),severity:"high",weight:6,description:"References American Arbitration Association rules"},{id:"arb-jams",category:"arbitration",pattern:e("\\bJAMS\\b"),severity:"high",weight:6,description:"References JAMS arbitration services"},{id:"arb-individual-basis",category:"arbitration",pattern:e("on\\s+an?\\s+individual\\s+basis\\s+only"),severity:"high",weight:7,description:"Requires claims to be brought individually, not as a group"},{id:"auto-renew-auto",category:"auto-renew",pattern:e("automatically\\s+renew"),severity:"high",weight:7,description:"Service automatically renews"},{id:"auto-renew-pattern",category:"auto-renew",pattern:e("auto-?renew(al|s|ed)?"),severity:"high",weight:7,description:"Auto-renewal clause"},{id:"auto-recurring",category:"auto-renew",pattern:e("recurring\\s+(billing|charge|payment)"),severity:"high",weight:6,description:"Recurring billing or charges"},{id:"auto-trial-convert",category:"auto-renew",pattern:e("(trial|free)[^.]{0,50}convert(s)?\\s+(to|into)\\s+(a\\s+)?(paid|subscription)"),severity:"high",weight:8,description:"Trial converts to paid subscription"},{id:"auto-cancel-before",category:"auto-renew",pattern:e("cancel[^.]{0,30}before[^.]{0,30}renewal"),severity:"medium",weight:5,description:"Must cancel before renewal date"},{id:"auto-charged-until",category:"auto-renew",pattern:e("(will\\s+be|are)\\s+charged[^.]{0,50}until\\s+(you\\s+)?cancel"),severity:"high",weight:6,description:"Charges continue until you cancel"},{id:"auto-no-refund",category:"auto-renew",pattern:e("no\\s+refunds?\\s+(will\\s+be\\s+)?(provided|given|issued)"),severity:"medium",weight:5,description:"No refunds policy"},{id:"data-share-third",category:"data-sharing",pattern:e("share[^.]{0,50}(with\\s+)?(third\\s+part(y|ies)|partners?|affiliates?)"),severity:"high",weight:7,description:"Shares data with third parties, partners, or affiliates"},{id:"data-sell-personal",category:"data-sharing",pattern:e("sell[^.]{0,30}(personal\\s+(information|data)|your\\s+(data|information))"),severity:"critical",weight:10,description:"May sell your personal information",critical:!0},{id:"data-advertising",category:"data-sharing",pattern:e("(advertising|ad)\\s+partners"),severity:"high",weight:6,description:"Shares data with advertising partners"},{id:"data-analytics",category:"data-sharing",pattern:e("analytics\\s+providers"),severity:"medium",weight:4,description:"Shares data with analytics providers"},{id:"data-disclose",category:"data-sharing",pattern:e("(may|will)\\s+disclose[^.]{0,50}(to\\s+)?(third\\s+part|government|law\\s+enforcement)"),severity:"medium",weight:5,description:"May disclose data to third parties or authorities"},{id:"data-transfer",category:"data-sharing",pattern:e("transfer[^.]{0,30}(your\\s+)?(personal\\s+)?(data|information)[^.]{0,30}(to|outside)"),severity:"medium",weight:5,description:"May transfer your data"},{id:"data-marketing",category:"data-sharing",pattern:e("(use|share)[^.]{0,30}(your\\s+)?(data|information)[^.]{0,30}marketing"),severity:"high",weight:6,description:"Uses your data for marketing purposes"},{id:"ret-long",category:"data-retention",pattern:e("retain[^.]{0,50}as\\s+long\\s+as"),severity:"medium",weight:5,description:"May retain data for extended periods"},{id:"ret-indefinitely",category:"data-retention",pattern:e("(retain|store|keep)[^.]{0,30}indefinitely"),severity:"high",weight:7,description:"May retain data indefinitely"},{id:"ret-legal-business",category:"data-retention",pattern:e("for\\s+(legal|business|regulatory)\\s+purposes"),severity:"low",weight:3,description:"Retains data for legal or business purposes"},{id:"ret-continue-store",category:"data-retention",pattern:e("(may|will)\\s+continue\\s+to\\s+store"),severity:"medium",weight:5,description:"May continue storing data after account closure"},{id:"ret-after-deletion",category:"data-retention",pattern:e("(after|even\\s+if)[^.]{0,30}(delet|terminat|clos)[^.]{0,30}(retain|keep|store)"),severity:"high",weight:6,description:"May retain data even after you request deletion"},{id:"ret-backup",category:"data-retention",pattern:e("(backup|archive)[^.]{0,30}(copies|data)[^.]{0,30}(may|will|could)\\s+(remain|persist)"),severity:"medium",weight:4,description:"Backup copies may persist after deletion"},{id:"change-anytime",category:"unilateral-changes",pattern:e("(we\\s+)?(may|can|reserve\\s+the\\s+right\\s+to)\\s+(modify|change|update|amend)[^.]{0,30}at\\s+any\\s+time"),severity:"medium",weight:5,description:"Terms may be changed at any time"},{id:"change-without-notice",category:"unilateral-changes",pattern:e("without\\s+(prior\\s+)?notice"),severity:"high",weight:6,description:"Changes may be made without notice"},{id:"change-continued-use",category:"unilateral-changes",pattern:e("continued\\s+use[^.]{0,50}(constitutes|means|indicates)\\s+(acceptance|agreement)"),severity:"medium",weight:5,description:"Continued use means you accept changes"},{id:"change-sole-discretion",category:"unilateral-changes",pattern:e("(in\\s+)?(our|its)\\s+sole\\s+(and\\s+absolute\\s+)?discretion"),severity:"medium",weight:4,description:"Company can make decisions at sole discretion"},{id:"change-terminate",category:"unilateral-changes",pattern:e("(may|can|reserve[^.]{0,20}right[^.]{0,10})\\s+terminat[^.]{0,30}(at\\s+any\\s+time|without\\s+(cause|reason))"),severity:"high",weight:6,description:"Service may be terminated at any time without cause"},{id:"liab-maximum",category:"liability",pattern:e("to\\s+the\\s+(maximum|fullest)\\s+extent\\s+permitted"),severity:"medium",weight:4,description:"Limits liability to maximum extent permitted by law"},{id:"liab-limitation",category:"liability",pattern:e("limitation\\s+of\\s+liability"),severity:"medium",weight:4,description:"Liability limitation clause"},{id:"liab-not-liable",category:"liability",pattern:e("(shall\\s+)?not\\s+(be\\s+)?(liable|responsible)\\s+for"),severity:"medium",weight:4,description:"Disclaims liability for certain issues"},{id:"liab-damages",category:"liability",pattern:e("(consequential|incidental|punitive|indirect|special)\\s+damages"),severity:"medium",weight:4,description:"Excludes certain types of damages"},{id:"liab-warranty",category:"liability",pattern:e("(disclaim|exclude)[^.]{0,30}warrant(y|ies)"),severity:"medium",weight:4,description:"Disclaims warranties"},{id:"liab-as-is",category:"liability",pattern:e('"?as\\s+is"?\\s+(and\\s+"?as\\s+available"?)?\\s+basis'),severity:"low",weight:3,description:'Service provided "as is" without guarantees'},{id:"liab-indemnify",category:"liability",pattern:e("(you\\s+)?(agree\\s+to\\s+)?indemnify[^.]{0,50}(us|company|service)"),severity:"medium",weight:5,description:"Requires you to indemnify the company"},{id:"gov-laws",category:"governing-law",pattern:e("governed\\s+by\\s+the\\s+laws\\s+of"),severity:"low",weight:2,description:"Specifies governing law jurisdiction"},{id:"gov-exclusive",category:"governing-law",pattern:e("exclusive\\s+(jurisdiction|venue)"),severity:"medium",weight:4,description:"Requires disputes in specific jurisdiction"},{id:"gov-venue",category:"governing-law",pattern:e("venue[^.]{0,30}shall\\s+be"),severity:"low",weight:3,description:"Specifies legal venue"},{id:"gov-waive-venue",category:"governing-law",pattern:e("waive[^.]{0,30}(objection|right)[^.]{0,30}venue"),severity:"medium",weight:5,description:"Waives right to object to venue"}];async function m(){try{let t=await chrome.storage.sync.get("settings");if(t.settings)return{...c,...t.settings};let i=await chrome.storage.local.get("settings");return i.settings?{...c,...i.settings}:c}catch(t){return console.error("ClauseGuard: Error loading settings:",t),c}}function h(t){try{return new URL(t).hostname}catch{return""}}var s=document.getElementById("status-section"),E=document.getElementById("domain-section"),C=document.getElementById("domain-name"),u=document.getElementById("domain-toggle"),o=document.getElementById("scan-btn"),f=document.getElementById("results-section"),b=document.getElementById("results-counts"),v=document.getElementById("risk-badge"),L=document.getElementById("legal-indicator"),M=document.getElementById("options-link"),l="",g;async function p(){let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});return t||null}function a(t,i,r=""){s.innerHTML=`
    <div class="status-message ${r}">
      <span class="status-icon">${t}</span>
      <span>${i}</span>
    </div>
  `}function R(){s.innerHTML=`
    <div class="status-loading">
      <div class="spinner"></div>
      <span>Loading...</span>
    </div>
  `}function A(t){let i=Object.entries(t).filter(([r,n])=>n>0).map(([r,n])=>`
        <div class="count-badge">
          <span class="count-icon">${y[r].icon}</span>
          <span class="count-value">${n}</span>
        </div>
      `).join("");i?b.innerHTML=i:b.innerHTML='<span style="color: #868e96; font-size: 12px;">No issues found</span>'}function w(t){f.style.display="block",v.textContent=t.riskLevel.toUpperCase(),v.className=`risk-badge risk-${t.riskLevel}`,A(t.categoryCounts)}async function S(){R();try{g=await m();let t=await p();if(!t?.url){a("\u26A0\uFE0F","Cannot access this page","status-disabled"),o.setAttribute("disabled","true");return}let i=t.url;if(!i.startsWith("http://")&&!i.startsWith("https://")){a("\u{1F6AB}","Cannot scan this page type","status-disabled"),o.setAttribute("disabled","true");return}l=h(i),C.textContent=l;let r=g.domainOverrides[l]??!0;if(u.checked=r,E.style.display="flex",!g.enabled){a("\u23F8\uFE0F","Extension is disabled","status-disabled");return}try{let n=await chrome.tabs.sendMessage(t.id,{type:"GET_STATUS"});if(n?.success&&n.data){let{lastScanResult:d,isLegalPage:T,isScanning:x}=n.data;x?(a("\u{1F504}","Scanning page...","status-scanning"),o.setAttribute("disabled","true")):(d&&w(d),s.innerHTML=""),T&&(L.style.display="flex")}else s.innerHTML=""}catch{a("\u2139\uFE0F","Click scan to analyze this page")}}catch(t){console.error("ClauseGuard: Popup error:",t),a("\u274C","An error occurred")}}async function I(){let t=await p();if(t?.id){o.setAttribute("disabled","true"),a("\u{1F504}","Scanning page...","status-scanning"),f.style.display="none";try{let i=await chrome.tabs.sendMessage(t.id,{type:"SCAN_NOW"});i?.success&&i.result?(w(i.result),s.innerHTML=""):a("\u274C","Scan failed - try refreshing the page")}catch{a("\u274C","Could not connect to page. Try refreshing.")}finally{o.removeAttribute("disabled")}}}async function k(){let t=u.checked;await chrome.runtime.sendMessage({type:"SET_DOMAIN_ENABLED",payload:{domain:l,enabled:t}});let i=await p();i?.id&&(chrome.tabs.reload(i.id),window.close())}function _(t){t.preventDefault(),chrome.runtime.openOptionsPage()}o.addEventListener("click",I);u.addEventListener("change",k);M.addEventListener("click",_);document.addEventListener("DOMContentLoaded",S);S();})();
