"use strict";(()=>{var s={enabled:!0,onlyLegalPages:!0,sensitivity:"normal",theme:"system",highlightColors:{arbitration:"#ff6b6b","auto-renew":"#ffa94d","data-sharing":"#ff8787","data-retention":"#ffd43b","unilateral-changes":"#69db7c",liability:"#74c0fc","governing-law":"#b197fc"},allowlist:[],denylist:[],domainOverrides:{},skipElements:["script","style","noscript","textarea","input","code","pre","svg"]};var t=e=>new RegExp(e,"gi"),H=[{id:"arb-binding",category:"arbitration",pattern:t("binding\\s+arbitration"),severity:"critical",weight:10,description:"Requires disputes to be resolved through binding arbitration",critical:!0},{id:"arb-class-action",category:"arbitration",pattern:t("class\\s+action\\s+waiver"),severity:"critical",weight:10,description:"Waives your right to participate in class action lawsuits",critical:!0},{id:"arb-waive-right",category:"arbitration",pattern:t("waive\\s+(your|the)\\s+right\\s+to"),severity:"high",weight:8,description:"Requires you to waive certain legal rights"},{id:"arb-jury-waive",category:"arbitration",pattern:t("jury\\s+trial[^.]*waive|waive[^.]*jury\\s+trial"),severity:"critical",weight:9,description:"Waives your right to a jury trial",critical:!0},{id:"arb-no-class",category:"arbitration",pattern:t("(may\\s+not|cannot|shall\\s+not)\\s+(bring|file|pursue)[^.]*class\\s+action"),severity:"high",weight:8,description:"Prohibits bringing class action lawsuits"},{id:"arb-aaa",category:"arbitration",pattern:t("(AAA|American\\s+Arbitration\\s+Association)"),severity:"high",weight:6,description:"References American Arbitration Association rules"},{id:"arb-jams",category:"arbitration",pattern:t("\\bJAMS\\b"),severity:"high",weight:6,description:"References JAMS arbitration services"},{id:"arb-individual-basis",category:"arbitration",pattern:t("on\\s+an?\\s+individual\\s+basis\\s+only"),severity:"high",weight:7,description:"Requires claims to be brought individually, not as a group"},{id:"auto-renew-auto",category:"auto-renew",pattern:t("automatically\\s+renew"),severity:"high",weight:7,description:"Service automatically renews"},{id:"auto-renew-pattern",category:"auto-renew",pattern:t("auto-?renew(al|s|ed)?"),severity:"high",weight:7,description:"Auto-renewal clause"},{id:"auto-recurring",category:"auto-renew",pattern:t("recurring\\s+(billing|charge|payment)"),severity:"high",weight:6,description:"Recurring billing or charges"},{id:"auto-trial-convert",category:"auto-renew",pattern:t("(trial|free)[^.]{0,50}convert(s)?\\s+(to|into)\\s+(a\\s+)?(paid|subscription)"),severity:"high",weight:8,description:"Trial converts to paid subscription"},{id:"auto-cancel-before",category:"auto-renew",pattern:t("cancel[^.]{0,30}before[^.]{0,30}renewal"),severity:"medium",weight:5,description:"Must cancel before renewal date"},{id:"auto-charged-until",category:"auto-renew",pattern:t("(will\\s+be|are)\\s+charged[^.]{0,50}until\\s+(you\\s+)?cancel"),severity:"high",weight:6,description:"Charges continue until you cancel"},{id:"auto-no-refund",category:"auto-renew",pattern:t("no\\s+refunds?\\s+(will\\s+be\\s+)?(provided|given|issued)"),severity:"medium",weight:5,description:"No refunds policy"},{id:"data-share-third",category:"data-sharing",pattern:t("share[^.]{0,50}(with\\s+)?(third\\s+part(y|ies)|partners?|affiliates?)"),severity:"high",weight:7,description:"Shares data with third parties, partners, or affiliates"},{id:"data-sell-personal",category:"data-sharing",pattern:t("sell[^.]{0,30}(personal\\s+(information|data)|your\\s+(data|information))"),severity:"critical",weight:10,description:"May sell your personal information",critical:!0},{id:"data-advertising",category:"data-sharing",pattern:t("(advertising|ad)\\s+partners"),severity:"high",weight:6,description:"Shares data with advertising partners"},{id:"data-analytics",category:"data-sharing",pattern:t("analytics\\s+providers"),severity:"medium",weight:4,description:"Shares data with analytics providers"},{id:"data-disclose",category:"data-sharing",pattern:t("(may|will)\\s+disclose[^.]{0,50}(to\\s+)?(third\\s+part|government|law\\s+enforcement)"),severity:"medium",weight:5,description:"May disclose data to third parties or authorities"},{id:"data-transfer",category:"data-sharing",pattern:t("transfer[^.]{0,30}(your\\s+)?(personal\\s+)?(data|information)[^.]{0,30}(to|outside)"),severity:"medium",weight:5,description:"May transfer your data"},{id:"data-marketing",category:"data-sharing",pattern:t("(use|share)[^.]{0,30}(your\\s+)?(data|information)[^.]{0,30}marketing"),severity:"high",weight:6,description:"Uses your data for marketing purposes"},{id:"ret-long",category:"data-retention",pattern:t("retain[^.]{0,50}as\\s+long\\s+as"),severity:"medium",weight:5,description:"May retain data for extended periods"},{id:"ret-indefinitely",category:"data-retention",pattern:t("(retain|store|keep)[^.]{0,30}indefinitely"),severity:"high",weight:7,description:"May retain data indefinitely"},{id:"ret-legal-business",category:"data-retention",pattern:t("for\\s+(legal|business|regulatory)\\s+purposes"),severity:"low",weight:3,description:"Retains data for legal or business purposes"},{id:"ret-continue-store",category:"data-retention",pattern:t("(may|will)\\s+continue\\s+to\\s+store"),severity:"medium",weight:5,description:"May continue storing data after account closure"},{id:"ret-after-deletion",category:"data-retention",pattern:t("(after|even\\s+if)[^.]{0,30}(delet|terminat|clos)[^.]{0,30}(retain|keep|store)"),severity:"high",weight:6,description:"May retain data even after you request deletion"},{id:"ret-backup",category:"data-retention",pattern:t("(backup|archive)[^.]{0,30}(copies|data)[^.]{0,30}(may|will|could)\\s+(remain|persist)"),severity:"medium",weight:4,description:"Backup copies may persist after deletion"},{id:"change-anytime",category:"unilateral-changes",pattern:t("(we\\s+)?(may|can|reserve\\s+the\\s+right\\s+to)\\s+(modify|change|update|amend)[^.]{0,30}at\\s+any\\s+time"),severity:"medium",weight:5,description:"Terms may be changed at any time"},{id:"change-without-notice",category:"unilateral-changes",pattern:t("without\\s+(prior\\s+)?notice"),severity:"high",weight:6,description:"Changes may be made without notice"},{id:"change-continued-use",category:"unilateral-changes",pattern:t("continued\\s+use[^.]{0,50}(constitutes|means|indicates)\\s+(acceptance|agreement)"),severity:"medium",weight:5,description:"Continued use means you accept changes"},{id:"change-sole-discretion",category:"unilateral-changes",pattern:t("(in\\s+)?(our|its)\\s+sole\\s+(and\\s+absolute\\s+)?discretion"),severity:"medium",weight:4,description:"Company can make decisions at sole discretion"},{id:"change-terminate",category:"unilateral-changes",pattern:t("(may|can|reserve[^.]{0,20}right[^.]{0,10})\\s+terminat[^.]{0,30}(at\\s+any\\s+time|without\\s+(cause|reason))"),severity:"high",weight:6,description:"Service may be terminated at any time without cause"},{id:"liab-maximum",category:"liability",pattern:t("to\\s+the\\s+(maximum|fullest)\\s+extent\\s+permitted"),severity:"medium",weight:4,description:"Limits liability to maximum extent permitted by law"},{id:"liab-limitation",category:"liability",pattern:t("limitation\\s+of\\s+liability"),severity:"medium",weight:4,description:"Liability limitation clause"},{id:"liab-not-liable",category:"liability",pattern:t("(shall\\s+)?not\\s+(be\\s+)?(liable|responsible)\\s+for"),severity:"medium",weight:4,description:"Disclaims liability for certain issues"},{id:"liab-damages",category:"liability",pattern:t("(consequential|incidental|punitive|indirect|special)\\s+damages"),severity:"medium",weight:4,description:"Excludes certain types of damages"},{id:"liab-warranty",category:"liability",pattern:t("(disclaim|exclude)[^.]{0,30}warrant(y|ies)"),severity:"medium",weight:4,description:"Disclaims warranties"},{id:"liab-as-is",category:"liability",pattern:t('"?as\\s+is"?\\s+(and\\s+"?as\\s+available"?)?\\s+basis'),severity:"low",weight:3,description:'Service provided "as is" without guarantees'},{id:"liab-indemnify",category:"liability",pattern:t("(you\\s+)?(agree\\s+to\\s+)?indemnify[^.]{0,50}(us|company|service)"),severity:"medium",weight:5,description:"Requires you to indemnify the company"},{id:"gov-laws",category:"governing-law",pattern:t("governed\\s+by\\s+the\\s+laws\\s+of"),severity:"low",weight:2,description:"Specifies governing law jurisdiction"},{id:"gov-exclusive",category:"governing-law",pattern:t("exclusive\\s+(jurisdiction|venue)"),severity:"medium",weight:4,description:"Requires disputes in specific jurisdiction"},{id:"gov-venue",category:"governing-law",pattern:t("venue[^.]{0,30}shall\\s+be"),severity:"low",weight:3,description:"Specifies legal venue"},{id:"gov-waive-venue",category:"governing-law",pattern:t("waive[^.]{0,30}(objection|right)[^.]{0,30}venue"),severity:"medium",weight:5,description:"Waives right to object to venue"}];async function c(){try{let e=await chrome.storage.sync.get("settings");if(e.settings)return{...s,...e.settings};let a=await chrome.storage.local.get("settings");return a.settings?{...s,...a.settings}:s}catch(e){return console.error("ClauseGuard: Error loading settings:",e),s}}async function x(e){let l={...await c(),...e};try{await chrome.storage.sync.set({settings:l})}catch(r){console.warn("ClauseGuard: Sync storage failed, using local:",r),await chrome.storage.local.set({settings:l})}}var d=document.getElementById("setting-theme"),g=document.getElementById("setting-enabled"),u=document.getElementById("setting-only-legal"),m=document.getElementById("setting-sensitivity"),k=document.getElementById("reset-colors"),f=document.getElementById("allowlist"),h=document.getElementById("allowlist-input"),P=document.getElementById("allowlist-add"),E=document.getElementById("denylist"),v=document.getElementById("denylist-input"),_=document.getElementById("denylist-add"),y=document.getElementById("toast"),b={arbitration:document.getElementById("color-arbitration"),"auto-renew":document.getElementById("color-auto-renew"),"data-sharing":document.getElementById("color-data-sharing"),"data-retention":document.getElementById("color-data-retention"),"unilateral-changes":document.getElementById("color-unilateral-changes"),liability:document.getElementById("color-liability"),"governing-law":document.getElementById("color-governing-law")},i,p=null;function w(e){let a="light";e==="system"?a=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a=e,document.documentElement.dataset.theme=a}function B(){p||(p=window.matchMedia("(prefers-color-scheme: dark)"),p.addEventListener("change",()=>{i.theme==="system"&&w("system")}))}function D(e="Settings saved"){let a=y.querySelector(".toast-message");a&&(a.textContent=e),y.classList.add("visible"),setTimeout(()=>{y.classList.remove("visible")},2e3)}async function n(){await x(i),D()}function o(e,a,l){if(a.length===0){e.innerHTML='<span style="color: #868e96; font-size: 13px;">No domains added</span>';return}e.innerHTML=a.map(r=>`
      <span class="domain-tag" data-domain="${r}">
        ${r}
        <button class="domain-remove" data-domain="${r}" title="Remove">\xD7</button>
      </span>
    `).join(""),e.querySelectorAll(".domain-remove").forEach(r=>{r.addEventListener("click",R=>{let L=R.currentTarget.dataset.domain;L&&l(L)})})}function I(e){return/^(\*\.)?([a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(e)||/^([a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(e)}function C(){let e=h.value.trim().toLowerCase();if(e){if(!I(e)){alert("Please enter a valid domain (e.g., example.com or *.example.com)");return}if(i.allowlist.includes(e)){alert("This domain is already in the allowlist");return}i.allowlist.push(e),h.value="",o(f,i.allowlist,S),n()}}function S(e){i.allowlist=i.allowlist.filter(a=>a!==e),o(f,i.allowlist,S),n()}function M(){let e=v.value.trim().toLowerCase();if(e){if(!I(e)){alert("Please enter a valid domain (e.g., example.com or *.example.com)");return}if(i.denylist.includes(e)){alert("This domain is already in the denylist");return}i.denylist.push(e),v.value="",o(E,i.denylist,T),n()}}function T(e){i.denylist=i.denylist.filter(a=>a!==e),o(E,i.denylist,T),n()}function O(){i.highlightColors={...s.highlightColors},Object.entries(b).forEach(([e,a])=>{a.value=i.highlightColors[e]}),n()}async function A(){i=await c(),B(),w(i.theme),d.value=i.theme,g.checked=i.enabled,u.checked=i.onlyLegalPages,m.value=i.sensitivity,Object.entries(b).forEach(([e,a])=>{a.value=i.highlightColors[e]}),o(f,i.allowlist,S),o(E,i.denylist,T),d.addEventListener("change",()=>{i.theme=d.value,w(i.theme),n()}),g.addEventListener("change",()=>{i.enabled=g.checked,n()}),u.addEventListener("change",()=>{i.onlyLegalPages=u.checked,n()}),m.addEventListener("change",()=>{i.sensitivity=m.value,n()}),Object.entries(b).forEach(([e,a])=>{a.addEventListener("change",()=>{i.highlightColors[e]=a.value,n()})}),k.addEventListener("click",O),P.addEventListener("click",C),_.addEventListener("click",M),h.addEventListener("keypress",e=>{e.key==="Enter"&&C()}),v.addEventListener("keypress",e=>{e.key==="Enter"&&M()})}document.addEventListener("DOMContentLoaded",A);A();})();
